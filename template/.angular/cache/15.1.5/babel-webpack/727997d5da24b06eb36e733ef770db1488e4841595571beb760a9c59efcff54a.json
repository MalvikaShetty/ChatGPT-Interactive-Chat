{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { ChatDB } from '../../shared/data/chat/chat';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Location } from '@angular/common';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nvar today = new Date().toLocaleString('en-US', {\n  hour: 'numeric',\n  minute: 'numeric',\n  hour12: true\n});\nexport class ChatService {\n  constructor(http, location) {\n    this.http = http;\n    this.location = location;\n    this.chat = [];\n    this.users = [];\n    this.chatHistory = [];\n    this.pastOpenchat = [];\n    this.base = \"https://localhost:44372/api/GPTStock\";\n    this._returnedChatGPTResponse = \"\";\n    this.listChats = [];\n    this.chatCompleted = false;\n    this.currentJsonData = [];\n    this.chatStarted = true;\n    this.currentList = [];\n    this.chat = ChatDB.chat;\n    this.users = ChatDB.chatUser;\n  }\n  //formChat:ChatMessages = new ChatMessages();\n  // Get User Data\n  getUsers() {\n    const users = new Observable(observer => {\n      observer.next(this.users);\n      observer.complete();\n    });\n    return users;\n  }\n  // Get cuurent user\n  getCurrentUser() {\n    return this.getUsers().pipe(map(users => {\n      return users.find(item => {\n        return item.authenticate === 0;\n      });\n    }));\n  }\n  // chat to user\n  chatToUser(id) {\n    return this.getUsers().pipe(map(users => {\n      return users.find(item => {\n        return item.id === id;\n      });\n    }));\n  }\n  // Get users chat\n  getChats(id) {\n    this.http.get(this.base + \"/getmessages/\" + id).toPromise().then(res => this.chatHistory = res);\n  }\n  // public getUserChat(): Observable<ChatMessages[]> {\n  //   const chat = new Observable(observer => {\n  //     observer.next(this.chat);\n  //     observer.complete();\n  //   });\n  //   return <Observable<ChatMessages[]>>chat;\n  // }\n  // // Get chat History\n  // public getChatHistory(id: number) {\n  //   return this.getUserChat().pipe(map(users => {\n  //     return users.find((item) => {\n  //       return item.userId === id;\n  //     });\n  //   }));\n  // }\n  // Send Message to user\n  sendMessage(chat, jsonData, questionInput) {\n    setTimeout(function () {\n      document.querySelector(\".chat-history\").scrollBy({\n        top: 200,\n        behavior: 'smooth'\n      });\n    }, 310);\n    this.responseMessage(chat, jsonData, questionInput);\n  }\n  wait(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n  responseMessage(chat, jsonData, questionInput) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const headers = new HttpHeaders({\n        'Content-Type': 'application/json'\n      });\n      this.http.post(this.base + \"/stocktable/\" + questionInput, jsonData, {\n        headers: headers\n      }).subscribe(result => {\n        this._returnedChatGPTResponse = result;\n      }, error => console.error(error));\n      setTimeout(() => {\n        this.listChatsMessagesInService = {\n          messageId: 0,\n          userId: 1,\n          question: questionInput,\n          answer: this._returnedChatGPTResponse\n        };\n        if (this.chatCompleted == false && this.chatStarted == true) {\n          this.listChats = [{\n            chatMessageId: 0,\n            userId: 1,\n            messages: []\n          }];\n          console.log(\"yayaya\");\n          this.currentList = this.listChats;\n          this.listChats[0].messages.push(this.listChatsMessagesInService);\n        } else {\n          console.log(\" oh no yaya did not go in the loop\");\n          this.currentList[0].messages.push(this.listChatsMessagesInService);\n          console.log(JSON.stringify(this.currentList) + \" yaya went in the loop\");\n        }\n        chat.messages.push(this.listChatsMessagesInService);\n        this.currentChatObject = Object.assign({}, chat);\n        this.currentJsonData = jsonData;\n        this.currentList = this.currentList;\n        console.log(JSON.stringify(this.listChats) + \" welllll\");\n        console.log(this._returnedChatGPTResponse + \" edennmom \");\n        this.chatStarted = false;\n        this.chatCompleted = false;\n        document.querySelector(\".chat-history\").scrollBy({\n          top: 200,\n          behavior: 'smooth'\n        });\n      }, 3000);\n      setTimeout(() => {\n        this.http.post(this.base + \"/postmessage\", chat).subscribe(error => console.error(error));\n        this.chatCompleted = true;\n        this.chatStarted = true;\n        this.listChats = null;\n        this.location.reload();\n      }, 40000);\n    });\n  }\n  getMessageByChatId(id) {\n    this.http.get(this.base + \"/getmessagesbychatId/\" + id).toPromise().then(res => this.pastOpenchat = res);\n  }\n}\nChatService.ɵfac = function ChatService_Factory(t) {\n  return new (t || ChatService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Location));\n};\nChatService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: ChatService,\n  factory: ChatService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["Observable","map","ChatDB","HttpClient","HttpHeaders","Location","today","Date","toLocaleString","hour","minute","hour12","ChatService","constructor","http","location","chat","users","chatUser","getUsers","observer","next","complete","getCurrentUser","pipe","find","item","authenticate","chatToUser","id","getChats","get","base","toPromise","then","res","chatHistory","sendMessage","jsonData","questionInput","setTimeout","document","querySelector","scrollBy","top","behavior","responseMessage","wait","ms","Promise","resolve","headers","post","subscribe","result","_returnedChatGPTResponse","error","console","listChatsMessagesInService","messageId","userId","question","answer","chatCompleted","chatStarted","listChats","chatMessageId","messages","log","currentList","push","JSON","stringify","currentChatObject","currentJsonData","reload","getMessageByChatId","pastOpenchat","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\malvi\\Angular\\template\\src\\app\\shared\\services\\chat.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Observable, Subscriber } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { ChatDB } from '../../shared/data/chat/chat';\nimport { ChatMessages, ChatUsers, Messages } from '../model/chat.models';\nimport { HttpClient,HttpHeaders  } from '@angular/common/http';\nimport { Location } from '@angular/common';\n\nvar today = new Date().toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true });\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ChatService {\n\n  public observer: Subscriber<{}>;\n  public chat: any[] = []\n  public users: any[] = []\n  public chatHistory : ChatMessages[] = []\n  public pastOpenchat: ChatMessages[] = []\n  readonly base=\"https://localhost:44372/api/GPTStock\"\n  _returnedChatGPTResponse: string=\"\";\n  listChatsMessagesInService: Messages; \n  listChats: ChatMessages[]=[];\n  public chatCompleted:boolean=false;\n  public currentChatObject:any;\n  public currentJsonData:any[]=[];\n  public chatStarted:boolean=true;\n  currentList:ChatMessages[]=[];\n\n  constructor(private http:HttpClient , private location:Location) {\n    this.chat = ChatDB.chat\n    this.users = ChatDB.chatUser\n  }\n\n  //formChat:ChatMessages = new ChatMessages();\n \n\n  // Get User Data\n  public getUsers(): Observable<ChatUsers[]> {\n    const users = new Observable(observer => {\n      observer.next(this.users);\n      observer.complete();\n    });\n    return <Observable<ChatUsers[]>>users;\n  }\n\n  // Get cuurent user\n  public getCurrentUser() {\n    return this.getUsers().pipe(map(users => {\n      return users.find((item) => {\n        return item.authenticate === 0;\n      });\n    }));\n  }\n\n  // chat to user\n  public chatToUser(id: number) {\n    return this.getUsers().pipe(map(users => {\n      return users.find((item) => {\n        return item.id === id;\n      });\n    }));\n  }\n\n  // Get users chat\n\n  public getChats(id:any){\n    this.http.get(this.base + \"/getmessages/\" + id).toPromise().then(res=> this.chatHistory = res as ChatMessages[]);\n  }\n\n\n  // public getUserChat(): Observable<ChatMessages[]> {\n  //   const chat = new Observable(observer => {\n  //     observer.next(this.chat);\n  //     observer.complete();\n  //   });\n  //   return <Observable<ChatMessages[]>>chat;\n  // }\n\n  // // Get chat History\n  // public getChatHistory(id: number) {\n  //   return this.getUserChat().pipe(map(users => {\n  //     return users.find((item) => {\n  //       return item.userId === id;\n  //     });\n  //   }));\n  // }\n\n  // Send Message to user\n  public sendMessage(chat:ChatMessages, jsonData, questionInput:string){\n        setTimeout(function () {\n          document.querySelector(\".chat-history\").scrollBy({ top: 200, behavior: 'smooth' });\n        }, 310)\n       this.responseMessage(chat,jsonData,questionInput);\n  }\n\n  wait(ms: number) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n \n  public async responseMessage(chat:ChatMessages,jsonData,questionInput:string) {\n    const headers = new HttpHeaders({'Content-Type': 'application/json'});\n    this.http.post<any>(this.base+\"/stocktable/\" + questionInput , jsonData , { headers: headers})\n    .subscribe(result => \n      { this._returnedChatGPTResponse = result;}, \n      error => console.error(error)); \n\n      setTimeout(()=> {\n        this.listChatsMessagesInService={\n          messageId: 0,\n          userId: 1,\n          question: questionInput,\n          answer: this._returnedChatGPTResponse\n        };\n\n       \n        if(this.chatCompleted==false && this.chatStarted==true){\n          this.listChats = [{\n            chatMessageId:0,\n            userId: 1,\n            messages:[] \n            }];\n            console.log(\"yayaya\");\n            this.currentList = this.listChats;\n            this.listChats[0].messages.push(this.listChatsMessagesInService);  \n           \n        }\n        else{\n          console.log(\" oh no yaya did not go in the loop\")\n          this.currentList[0].messages.push(this.listChatsMessagesInService);\n          console.log(JSON.stringify(this.currentList) + \" yaya went in the loop\")\n         \n        }\n          chat.messages.push(this.listChatsMessagesInService);\n          this.currentChatObject = { ...chat };\n          this.currentJsonData= jsonData;\n          this.currentList = this.currentList;\n         \n      \n          console.log( JSON.stringify(this.listChats) + \" welllll\")\n       \n          console.log(this._returnedChatGPTResponse + \" edennmom \");\n          this.chatStarted=false;\n          this.chatCompleted=false;\n          document.querySelector(\".chat-history\").scrollBy({ top: 200, behavior: 'smooth' });\n      }, 3000);\n\n      \n\n      setTimeout(()=> {\n        this.http.post(this.base + \"/postmessage\" , chat).subscribe( error => console.error(error));\n        this.chatCompleted=true;\n        this.chatStarted=true;\n        this.listChats=null;\n        this.location.reload();\n      },40000)\n\n     \n  }\n\n  public getMessageByChatId(id:any){\n    this.http.get(this.base + \"/getmessagesbychatId/\" + id).toPromise().then(res=> this.pastOpenchat = res as ChatMessages[]);\n  }\n\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}