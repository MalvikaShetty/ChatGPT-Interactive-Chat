{"ast":null,"code":"\"use strict\";\n\nvar layouts = require(\"../layouts\");\nvar mailer = require(\"nodemailer\");\nvar os = require('os');\nvar logEventBuffer = [];\nvar subjectLayout;\nvar layout;\nvar unsentCount = 0;\nvar shutdownTimeout;\nvar sendInterval;\nvar sendTimer;\nvar config;\nfunction sendBuffer() {\n  if (logEventBuffer.length > 0) {\n    var transportOpts = getTransportOptions(config);\n    var transport = mailer.createTransport(transportOpts);\n    var firstEvent = logEventBuffer[0];\n    var body = \"\";\n    var count = logEventBuffer.length;\n    while (logEventBuffer.length > 0) {\n      body += layout(logEventBuffer.shift(), config.timezoneOffset) + \"\\n\";\n    }\n    var msg = {\n      to: config.recipients,\n      subject: config.subject || subjectLayout(firstEvent),\n      headers: {\n        \"Hostname\": os.hostname()\n      }\n    };\n    if (true === config.attachment.enable) {\n      msg[config.html ? \"html\" : \"text\"] = config.attachment.message;\n      msg.attachments = [{\n        filename: config.attachment.filename,\n        contentType: 'text/x-log',\n        content: body\n      }];\n    } else {\n      msg[config.html ? \"html\" : \"text\"] = body;\n    }\n    if (config.sender) {\n      msg.from = config.sender;\n    }\n    transport.sendMail(msg, function (error) {\n      if (error) {\n        console.error(\"log4js.smtpAppender - Error happened\", error);\n      }\n      transport.close();\n      unsentCount -= count;\n    });\n  }\n}\nfunction getTransportOptions() {\n  var transportOpts = null;\n  if (config.SMTP) {\n    transportOpts = config.SMTP;\n  } else if (config.transport) {\n    var plugin = config.transport.plugin || 'smtp';\n    var transportModule = 'nodemailer-' + plugin + '-transport';\n    var transporter = require(transportModule);\n    transportOpts = transporter(config.transport.options);\n  }\n  return transportOpts;\n}\nfunction scheduleSend() {\n  if (!sendTimer) {\n    sendTimer = setTimeout(function () {\n      sendTimer = null;\n      sendBuffer();\n    }, sendInterval);\n  }\n}\n\n/**\n * SMTP Appender. Sends logging events using SMTP protocol. \n * It can either send an email on each event or group several \n * logging events gathered during specified interval.\n *\n * @param _config appender configuration data\n *    config.sendInterval time between log emails (in seconds), if 0\n *    then every event sends an email\n *    config.shutdownTimeout time to give up remaining emails (in seconds; defaults to 5).\n * @param _layout a function that takes a logevent and returns a string (defaults to basicLayout).\n */\nfunction smtpAppender(_config, _layout) {\n  config = _config;\n  if (!config.attachment) {\n    config.attachment = {};\n  }\n  config.attachment.enable = !!config.attachment.enable;\n  config.attachment.message = config.attachment.message || \"See logs as attachment\";\n  config.attachment.filename = config.attachment.filename || \"default.log\";\n  layout = _layout || layouts.basicLayout;\n  subjectLayout = layouts.messagePassThroughLayout;\n  sendInterval = config.sendInterval * 1000 || 0;\n  shutdownTimeout = ('shutdownTimeout' in config ? config.shutdownTimeout : 5) * 1000;\n  return function (loggingEvent) {\n    unsentCount++;\n    logEventBuffer.push(loggingEvent);\n    if (sendInterval > 0) {\n      scheduleSend();\n    } else {\n      sendBuffer();\n    }\n  };\n}\nfunction configure(_config) {\n  config = _config;\n  if (_config.layout) {\n    layout = layouts.layout(_config.layout.type, _config.layout);\n  }\n  return smtpAppender(_config, layout);\n}\nfunction shutdown(cb) {\n  if (shutdownTimeout > 0) {\n    setTimeout(function () {\n      if (sendTimer) clearTimeout(sendTimer);\n      sendBuffer();\n    }, shutdownTimeout);\n  }\n  (function checkDone() {\n    if (unsentCount > 0) {\n      setTimeout(checkDone, 100);\n    } else {\n      cb();\n    }\n  })();\n}\nexports.name = \"smtp\";\nexports.appender = smtpAppender;\nexports.configure = configure;\nexports.shutdown = shutdown;","map":{"version":3,"names":["layouts","require","mailer","os","logEventBuffer","subjectLayout","layout","unsentCount","shutdownTimeout","sendInterval","sendTimer","config","sendBuffer","length","transportOpts","getTransportOptions","transport","createTransport","firstEvent","body","count","shift","timezoneOffset","msg","to","recipients","subject","headers","hostname","attachment","enable","html","message","attachments","filename","contentType","content","sender","from","sendMail","error","console","close","SMTP","plugin","transportModule","transporter","options","scheduleSend","setTimeout","smtpAppender","_config","_layout","basicLayout","messagePassThroughLayout","loggingEvent","push","configure","type","shutdown","cb","clearTimeout","checkDone","exports","name","appender"],"sources":["C:/Users/malvi/Angular/template/node_modules/sql-to-json/node_modules/log4js/lib/appenders/smtp.js"],"sourcesContent":["\"use strict\";\n\nvar layouts = require(\"../layouts\");\nvar mailer = require(\"nodemailer\");\nvar os = require('os');\n\nvar logEventBuffer = [];\nvar subjectLayout;\nvar layout;\n\nvar unsentCount = 0;\nvar shutdownTimeout;\n\nvar sendInterval;\nvar sendTimer;\n\nvar config;\n\nfunction sendBuffer() {\n    if (logEventBuffer.length > 0) {\n\n        var transportOpts = getTransportOptions(config);\n        var transport = mailer.createTransport(transportOpts);\n        var firstEvent = logEventBuffer[0];\n        var body = \"\";\n        var count = logEventBuffer.length;\n        while (logEventBuffer.length > 0) {\n            body += layout(logEventBuffer.shift(), config.timezoneOffset) + \"\\n\";\n        }\n\n        var msg = {\n            to: config.recipients,\n            subject: config.subject || subjectLayout(firstEvent),\n            headers: {\"Hostname\": os.hostname()}\n        };\n\n        if (true === config.attachment.enable) {\n            msg[config.html ? \"html\" : \"text\"] = config.attachment.message;\n            msg.attachments = [\n                {\n                    filename: config.attachment.filename,\n                    contentType: 'text/x-log',\n                    content: body\n                }\n            ];\n        } else {\n            msg[config.html ? \"html\" : \"text\"] = body;\n        }\n\n        if (config.sender) {\n            msg.from = config.sender;\n        }\n        transport.sendMail(msg, function (error) {\n            if (error) {\n                console.error(\"log4js.smtpAppender - Error happened\", error);\n            }\n            transport.close();\n            unsentCount -= count;\n        });\n    }\n}\n\nfunction getTransportOptions() {\n    var transportOpts = null;\n    if (config.SMTP) {\n        transportOpts = config.SMTP;\n    } else if (config.transport) {\n        var plugin = config.transport.plugin || 'smtp';\n        var transportModule = 'nodemailer-' + plugin + '-transport';\n        var transporter = require(transportModule);\n        transportOpts = transporter(config.transport.options);\n    }\n\n    return transportOpts;\n}\n\nfunction scheduleSend() {\n    if (!sendTimer) {\n        sendTimer = setTimeout(function () {\n            sendTimer = null;\n            sendBuffer();\n        }, sendInterval);\n    }\n}\n\n/**\n * SMTP Appender. Sends logging events using SMTP protocol. \n * It can either send an email on each event or group several \n * logging events gathered during specified interval.\n *\n * @param _config appender configuration data\n *    config.sendInterval time between log emails (in seconds), if 0\n *    then every event sends an email\n *    config.shutdownTimeout time to give up remaining emails (in seconds; defaults to 5).\n * @param _layout a function that takes a logevent and returns a string (defaults to basicLayout).\n */\nfunction smtpAppender(_config, _layout) {\n    config = _config;\n\n    if (!config.attachment) {\n        config.attachment = {};\n    }\n\n    config.attachment.enable = !!config.attachment.enable;\n    config.attachment.message = config.attachment.message || \"See logs as attachment\";\n    config.attachment.filename = config.attachment.filename || \"default.log\";\n    layout = _layout || layouts.basicLayout;\n    subjectLayout = layouts.messagePassThroughLayout;\n    sendInterval = config.sendInterval * 1000 || 0;\n\n    shutdownTimeout = ('shutdownTimeout' in config ? config.shutdownTimeout : 5) * 1000;\n\n    return function (loggingEvent) {\n        unsentCount++;\n        logEventBuffer.push(loggingEvent);\n        if (sendInterval > 0) {\n            scheduleSend();\n        } else {\n            sendBuffer();\n        }\n    };\n}\n\nfunction configure(_config) {\n    config = _config;\n    if (_config.layout) {\n        layout = layouts.layout(_config.layout.type, _config.layout);\n    }\n    return smtpAppender(_config, layout);\n}\n\nfunction shutdown(cb) {\n    if (shutdownTimeout > 0) {\n        setTimeout(function () {\n            if (sendTimer)\n                clearTimeout(sendTimer);\n            sendBuffer();\n        }, shutdownTimeout);\n    }\n    (function checkDone() {\n      if (unsentCount > 0) {\n        setTimeout(checkDone, 100);\n      } else {\n        cb();\n      }\n    })();\n}\n\nexports.name = \"smtp\";\nexports.appender = smtpAppender;\nexports.configure = configure;\nexports.shutdown = shutdown;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}